<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Coding in the Sky]]></title>
  <link href="http://laputa.io/atom.xml" rel="self"/>
  <link href="http://laputa.io/"/>
  <updated>2014-10-24T12:02:36+09:00</updated>
  <id>http://laputa.io/</id>
  <author>
    <name><![CDATA[laputa]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[using karma]]></title>
    <link href="http://laputa.io/blog/2014/10/24/using-karma/"/>
    <updated>2014-10-24T10:09:48+09:00</updated>
    <id>http://laputa.io/blog/2014/10/24/using-karma</id>
    <content type="html"><![CDATA[<p>Recently I&rsquo;m trying to use <a href="https://karma-runner.github.io/">Karma</a> to do front-end javascript unit test. Here is my simple startup of setting up.</p>

<h2>Boilerplate project</h2>

<p>First, let&rsquo;s make a boilerplate project for doing the test. Make prject structure like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>karma-boilerplate
</span><span class='line'>├── package.json
</span><span class='line'>├── README.md
</span><span class='line'>├── src
</span><span class='line'>│   └── hello.js
</span><span class='line'>└── test
</span><span class='line'>    └── hellpSpec.js</span></code></pre></td></tr></table></div></figure>


<p><code>hello.js</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function hello() {
</span><span class='line'>  return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p><code>helloSpec.js</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>describe('hello', function() {
</span><span class='line'>  it('should return 0', function() {
</span><span class='line'>    expect(hello()).toEqual(0);
</span><span class='line'>  });
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>Or you can directly get the source code from <a href="https://github.com/justlaputa/karma-boilerplate">Github</a>.</p>

<h2>Install packages</h2>

<p>Karma is written by google&rsquo;s <a href="https://angularjs.org/">AngularJS</a> team, and they use <a href="http://nodejs.org/">Node.js</a>, so first we need to have node.js installed. If you don&rsquo;t have it, try to install in your platform: <a href="http://nodejs.org/download/">download</a>.</p>

<p>After that, let&rsquo;s install the packages we need:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install karma --save-dev
</span><span class='line'>$ npm install karma-jasmine karma-phantomjs-launcher karma-chrome-launcher --save-dev</span></code></pre></td></tr></table></div></figure>


<p><code>karma</code> is the test runner, it will load our tests in browsers and run them, while others are all karma plugins.</p>

<ul>
<li>karma-jasmine: the unit test assertion library, it enables us to write BDD style test cases</li>
<li>karma-phantomjs-launcher: it enables karma to launcher the headless webkit browser phantomjs, which is convinient to do quick test</li>
<li>karma-chrome-launcher: it enables karma to launcher google Chrome to do read browser test</li>
</ul>


<h2>Configuration</h2>

<p>Karma has an <a href="https://karma-runner.github.io/0.12/intro/configuration.html">interactive</a> command to help us generate config files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./node_modules/karma/bin/karma init</span></code></pre></td></tr></table></div></figure>


<p>It will ask you some questions and you will be able to choose the answers from command line, after that it will generate a <code>karma.config.js</code> file for you.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./node_modules/karma/bin/karma init
</span><span class='line'>
</span><span class='line'>Which testing framework do you want to use ?
</span><span class='line'>Press tab to list possible options. Enter to move to the next question.
</span><span class='line'>&gt; jasmine
</span><span class='line'>
</span><span class='line'>Do you want to use Require.js ?
</span><span class='line'>This will add Require.js plugin.
</span><span class='line'>Press tab to list possible options. Enter to move to the next question.
</span><span class='line'>&gt; no
</span><span class='line'>
</span><span class='line'>Do you want to capture any browsers automatically ?
</span><span class='line'>Press tab to list possible options. Enter empty string to move to the next question.
</span><span class='line'>&gt; Chrome
</span><span class='line'>&gt; PhantomJS
</span><span class='line'>&gt;
</span><span class='line'>
</span><span class='line'>What is the location of your source and test files ?
</span><span class='line'>You can use glob patterns, eg. "js/*.js" or "test/**/*Spec.js".
</span><span class='line'>Enter empty string to move to the next question.
</span><span class='line'>&gt; src/**/*.js
</span><span class='line'>&gt; test/**/*Spec.js
</span><span class='line'>&gt;
</span><span class='line'>
</span><span class='line'>Should any of the files included by the previous patterns be excluded ?
</span><span class='line'>You can use glob patterns, eg. "**/*.swp".
</span><span class='line'>Enter empty string to move to the next question.
</span><span class='line'>&gt;
</span><span class='line'>
</span><span class='line'>Do you want Karma to watch all the files and run the tests on change ?
</span><span class='line'>Press tab to list possible options.
</span><span class='line'>&gt; yes
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Config file generated at "/home/laputa/workspace/github/karma-boilerplate/karma.config.js".</span></code></pre></td></tr></table></div></figure>


<p>Then it will generate <code>karma.config.js</code> file for you, there are two points about the karma config:</p>

<h4>Files</h4>

<p>Karma does not serve all files by default, which means it will only serve the files you specified in the config file. The problems come when you are using some loaders like <a href="http://requirejs.org/">RequireJS</a> or <a href="https://developers.google.com/closure/">Google Closure</a>. You should specify all you source code in <code>files</code> configuration, and prevent them to be included in the html page by default. For example:</p>

<p><em>RequireJS</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>files: [
</span><span class='line'>  { pattern: 'src/**/*.js', included: false, served: true },
</span><span class='line'>  'test/**/*Spec.js'
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p><em>Closure</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>files: [
</span><span class='line'>  { pattern: 'CLOSURE_LIB_ROOT/**/*.js', included: false, served: true },
</span><span class='line'>  'src/**/*Spec.js'
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<h4>Iframe</h4>

<p>By default, Karma will load all script in an iframe, and run the test, but when you are using PhantomJS, phantomjs will expose global variables like <code>window._phantom</code>. If we want to detect phantomjs in our test source like:</p>

<p><code>testSpec.js</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  if (window._phantom) {
</span><span class='line'>    //Add some function that phantomjs not support
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>It won&rsquo;t happen because the <code>_phantom</code> global variable will not be set in the iframe. Now we need to specify Karma to not use iframe:</p>

<p><code>karma.config.js</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  client: {
</span><span class='line'>    useIframe: false
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<p>By this, all test will be run in a new window instead of in an iframe.</p>

<h2>Use grunt-karma</h2>

<p>If you want to use grunt to start karma, which will be helpful for CI runners, you can try to use <a href="https://github.com/karma-runner/grunt-karma">grunt-karma</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install grunt-karma --save-dev
</span><span class='line'>$ npm install karma-junit-reporter --save-dev //this allows to output junit report for CI like Jenkins</span></code></pre></td></tr></table></div></figure>


<p>and you can write all your configuration in the Gruntfile.js instead of in a separate config.js file, it is also able to define separate options for different environment, like CI and local development. A simple example:</p>

<p><code>Gruntfile.js</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>karma: {
</span><span class='line'>  options: {
</span><span class='line'>    frameworks: ['jasmine'],
</span><span class='line'>    files: [
</span><span class='line'>      'src/**/*.js',
</span><span class='line'>      'test/**/*.js'
</span><span class='line'>    ]
</span><span class='line'>  },
</span><span class='line'>  continuous: {
</span><span class='line'>    singleRun: true,
</span><span class='line'>    browsers: ['PhantomJS'],
</span><span class='line'>    reporters: 'junit',
</span><span class='line'>    junitReporter: {
</span><span class='line'>      outputFile: 'test/reports/karma-results.xml'
</span><span class='line'>    },
</span><span class='line'>    client: {
</span><span class='line'>      useIframe: false //to avoid phantomjs detect failure
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>  dev: {
</span><span class='line'>    reporters: 'dots',
</span><span class='line'>    bro1wsers: ['Chrome']
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>when run <code>grunt karma:continuous</code>, it will avoid using iframe, launch PhantomJS and output junit report for CI. while run <code>grunt karma:dev</code> will launcher Chrome for developers.</p>

<p>For the full project, please take a look at my simple <a href="https://github.com/justlaputa/karma-boilerplate">Github source</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My first chrome extension]]></title>
    <link href="http://laputa.io/blog/2013/06/26/my-first-chrome-extension/"/>
    <updated>2013-06-26T21:02:00+09:00</updated>
    <id>http://laputa.io/blog/2013/06/26/my-first-chrome-extension</id>
    <content type="html"><![CDATA[<p>Yesterday I just published my first chrome extension <em>Jenkins Monitor</em> in <a href="https://chrome.google.com/webstore/detail/jenkins-monitor/chhebdmlkojbdgadopnedfmoapbeiofi">Chrome Webstore</a>, finally.</p>

<p>I checker my <a href="https://github.com/justlaputa/jenkins-monitor/commits/master">commit history</a> in <a href="https://github.com/justlaputa/jenkins-monitor">Github</a>, it was started at <strong>Apr 24</strong>, and after almost 2 months, I released and published the first version, though it only has very simple and limited features.</p>

<!--more-->


<p>The idea is from my daily work, my team use <a href="http://jenkins-ci.org/">Jenkins CI</a> every day to build and test our project. Our Jenkins is hosted on <a href="https://aws.amazon.com/ec2/">EC2</a>, and the hardware is not so powerful(maybe micro instance, not sure). So sometimes it is very slow to load the Jenkins web page in our browser. Then I decide to find some way to solve this problem. Luckily, Jenkins has <a href="https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API">REST API</a>, and I&rsquo;m doing front-end development for some time, making a chrome extension to use the REST API would be a good solution, and I was always thinking to try to develop a chrome extension. So I just started this project, easily.</p>

<p>Still, it surprised me at the first that Chrome Extension development is so easy, all the things I need is just front-end web development technology. HTML, CSS, JS, it is just like make web pages. Thanks to my job, I use them everyday. What&rsquo;s more, I have powerful tools to help me make this extension, like <a href="http://jquery.com/">jQuery</a>, <a href="http://twitter.github.io/bootstrap/">Bootstrap</a>, <a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a>, <a href="http://handlebarsjs.com/">Handlebars</a>, <a href="http://gruntjs.com/">Gruntjs</a>, etc.</p>

<p>These tools saved my a lot of time, and makes the implementation simple. I just need to use jQuery <a href="http://api.jquery.com/jQuery.ajax/">ajax</a> call to get all jobs data from jenkins API, then feed the data to handlebar compiled templates, then I have a jenkins jobs list rendered by properly by Bootstrap css:</p>

<p><img src="https://lh3.googleusercontent.com/-NKsuyHoB4tc/UcrwpFDiI7I/AAAAAAAAA2g/gcsqCiIXSUw/w1117-h698-no/Screen+Shot+2013-06-24+at+10.36.30+PM.png" title="Jenkins job list" alt="Jenkins Job List" /></p>

<p>Then I want to automatically update the jobs data from jenkins server, I need a timer. I found that I can use chrome extension <a href="http://developer.chrome.com/extensions/alarms.html">alarm</a> API to achieve this.</p>

<p>Last feature before I can release is <em>Notification</em>, I want my jenkins monitor to notify me when there are jobs <code>added/removed/start/done</code>. Not surprisingly, chrome supports <a href="http://developer.chrome.com/extensions/desktop_notifications.html">Desktop Notification</a>, which is just like <a href="http://www.html5rocks.com/en/tutorials/notifications/quick/">HTML5 Notification API</a>, it is quite simple to use and I just use one after work night to implement this:</p>

<p><img src="https://lh3.googleusercontent.com/-zOOMaQu8ZRo/Ucrwq0p8UfI/AAAAAAAAA2o/MPkDGcFo6lQ/w640-h400-no/Screen+Shot+2013-06-24+at+11.04.31+PM.png%20notification" alt="Jenkins monitor notification" /></p>

<p>That&rsquo;s all I need for now! I already asked my colleague to try it and he says it is good. Though it does not have much features,  I still decide to publish it to the chrome webstore. I think making progress is good for me, and I already have plan to improve it in the <a href="https://github.com/justlaputa/jenkins-monitor/issues?milestone=1&amp;page=1&amp;state=open">next version</a>.</p>

<p>If you are interested to try, just install it from <a href="https://chrome.google.com/webstore/detail/jenkins-monitor/chhebdmlkojbdgadopnedfmoapbeiofi">chrome web store</a>, and of cause code contribution is welcomed in <a href="https://github.com/justlaputa/jenkins-monitor/issues?milestone=&amp;page=1&amp;state=open">github</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Blog URL changed]]></title>
    <link href="http://laputa.io/blog/2013/05/14/blog-url-changed/"/>
    <updated>2013-05-14T22:40:00+09:00</updated>
    <id>http://laputa.io/blog/2013/05/14/blog-url-changed</id>
    <content type="html"><![CDATA[<p>今天我终于把2年半前注册的域名 <a href="http://justlaputa.com">justlaputa.com</a> 成功重定向到 Github pages 了。</p>

<p>之前试过 DNS forward，但是URL不能完美显示，今天无意中想找找有没有好办法把域名重定向到 Github，意料之外找到了Github 的官方配置方法 <a href="https://help.github.com/articles/setting-up-a-custom-domain-with-pages">Setting up a custom domain with Pages</a>，居然成功了！</p>

<!--more-->


<p>完全按照教程来就OK了：</p>

<ol>
<li>在github pages repository下面新建一个文件 <a href="https://github.com/justlaputa/justlaputa.github.com/blob/master/CNAME">CNAME</a>，里面写上想要map的域名，这个文件会告诉github pages把 <code>*.github.io</code> 重定向到自己的域名（try <a href="http://justlaputa.github.io">justlaputa.github.io</a>）</li>
<li>修改域名的<a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types">A record</a> 为 github pages service ip：<code>204.232.175.78</code></li>
</ol>


<p>然后等待DNS修改生效就OK了！</p>

<p>Awesome Github!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Test MediaElement.js locally]]></title>
    <link href="http://laputa.io/blog/2013/03/05/test-mediaelement-dot-js-locally/"/>
    <updated>2013-03-05T20:21:00+09:00</updated>
    <id>http://laputa.io/blog/2013/03/05/test-mediaelement-dot-js-locally</id>
    <content type="html"><![CDATA[<p>Today I was trying to use <a href="http://mediaelementjs.com/">mediaelement.js</a> to play mp3 audio in browsers. I thought it was easy, but still I&rsquo;ve met problems, mainly with <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a>.</p>

<!--more-->


<p>First, I want to use static local html file to test the library, which is fast to do. Here is the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tree mejs
</span><span class='line'>mejs
</span><span class='line'>├── css
</span><span class='line'>│   ├── background.png
</span><span class='line'>│   ├── bigplay.png
</span><span class='line'>│   ├── bigplay.svg
</span><span class='line'>│   ├── controls-ted.png
</span><span class='line'>│   ├── controls-wmp-bg.png
</span><span class='line'>│   ├── controls-wmp.png
</span><span class='line'>│   ├── controls.png
</span><span class='line'>│   ├── controls.svg
</span><span class='line'>│   ├── loading.gif
</span><span class='line'>│   └── mediaelementplayer.css
</span><span class='line'>├── index.html
</span><span class='line'>├── js
</span><span class='line'>│   ├── app.js
</span><span class='line'>│   ├── flashmediaelement.swf
</span><span class='line'>│   ├── jquery.js
</span><span class='line'>│   └── mediaelement-and-player.js
</span><span class='line'>└── media
</span><span class='line'>    └── music.mp3
</span><span class='line'>
</span><span class='line'>3 directories, 16 files</span></code></pre></td></tr></table></div></figure>


<p><strong>index.html</strong> :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!doctype html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>    &lt;link type="text/css" rel="stylesheet" href="css/mediaelementplayer.css" /&gt;
</span><span class='line'>    &lt;script src="js/jquery.js"&gt;&lt;/script&gt;
</span><span class='line'>    &lt;script src="js/mediaelement-and-player.js"&gt;&lt;/script&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>    &lt;audio type="audio/mp3" src="media/music.mp3" controls&gt;&lt;/audio&gt;
</span><span class='line'>    &lt;script src="js/app.js"&gt;&lt;/script&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p><strong>app.js</strong> :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(function() {
</span><span class='line'>    $('audio').mediaelementplayer();
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>As firefox does not support <a href="https://developer.mozilla.org/en-US/docs/HTML/Supported_media_formats#compat-desktop">MP3 format</a>, if we don&rsquo;t include the <code>app.js</code> file to use mediaelement.js, the browser will not show the audio bar, and gives an error in js console:</p>

<blockquote><p>HTTP &ldquo;Content-Type&rdquo; of &ldquo;audio/mpeg&rdquo; is not supported. Load of media resource file:///Users/hanxiao/workspace/test/mejs/media/music.mp3 failed. @ file:///Users/hanxiao/workspace/test/mejs/index.html</p></blockquote>

<p>So we include <code>app.js</code> and call <code>mediaelementplayer()</code> function to let mediaelement.js use the flash fallback to play mp3 in firefox. But problems happens here, the audio bar shows, but no control icon, and the audio can not play.</p>

<p>The reason is that flash plugin has <a href="https://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html#117502">security control</a>, which prevents flash plugin to access the local mp3 file. To allow this, open a flash video site like <a href="https://www.youtube.com/">youtube</a> or <a href="http://www.youku.com/">youku</a> if you can&rsquo;t. Open one video page, and wait the video to play, not we have a running flash plugin, right click on it and choose <strong>Global Settings…->Advanced->Trusted Location Settings…</strong> add the directory of the local site to it, then open <code>index.html</code> in firefox, now the mp3 plays like a charm.</p>

<p>Something intresting: though firefox declares not support mp3, but when I open the mp3 file directly in firefox, it plays well, and the inspector show this code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;embed type="audio/mpeg" src="file:///Users/hanxiao/workspace/test/mejs/media/music.mp3" name="plugin" height="100%" width="100%"&gt;</span></code></pre></td></tr></table></div></figure>


<p>Do you know why? Please comment if you do, cause currently I don&rsquo;t..</p>

<p>Update: Created a <a href="git@github.com:justlaputa/mejs-test.git">github repo</a> about this code.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Monthly Review for Dec]]></title>
    <link href="http://laputa.io/blog/2012/12/25/monthly-review-for-dec/"/>
    <updated>2012-12-25T21:47:00+09:00</updated>
    <id>http://laputa.io/blog/2012/12/25/monthly-review-for-dec</id>
    <content type="html"><![CDATA[<p>I checked that my last review is in September, so I guess this should be a 3-Months Review, but I barely remember what I have done in October and November, I&rsquo;ll try to recall what I have done in this month.</p>

<!--more-->


<h2>Jasmine</h2>

<p>I have continued to learn <a href="http://pivotal.github.com/jasmine/">Jasmine</a>, and also given a <a href="https://speakerdeck.com/justlaputa/lt-jasmine">lighting talk</a> about it.</p>

<p>Also I have worked on <a href="https://github.com/velesin/jasmine-jquery">jasmine-jquery</a> and did some <a href="https://github.com/velesin/jasmine-jquery/pulls/justlaputa?direction=desc&amp;page=1&amp;sort=created&amp;state=closed">contribution</a> to this pretty library.</p>

<h2>Testem</h2>

<p>When learning <a href="https://github.com/airportyh/testem">Test&#8217;em</a>, I started to learn <a href="http://nodejs.org/">node.js</a>. Node.js is awesome, and Test&#8217;em really saved my time. I completely switched from <a href="https://code.google.com/p/js-test-driver/">JsTD</a> to test&#8217;em, it&rsquo;s easy to config, fast, supports <a href="https://code.google.com/p/js-test-driver/">RequireJS</a> elegantly, and very cool. I started to do real <a href="https://en.wikipedia.org/wiki/Test-driven_development">TDD</a> now.</p>

<p>For using it, I also learned something about <a href="http://phantomjs.org/">PhantomJS</a> and <a href="https://en.wikipedia.org/wiki/Code_coverage">code coverage</a>, and try to write a <a href="http://ltp.sourceforge.net/test/coverage/lcov.readme.php">lcov</a> reporter for <a href="https://github.com/richardbutler/testem-coverage-sandbox/pull/1">jasmine</a>, it&rsquo;s interesting stuff.</p>

<h2>Lighting Talking</h2>

<p>Give a <a href="https://speakerdeck.com/justlaputa/scope-and-hoisting-in-javascript">lighting talking</a> about <a href="http://www.adequatelygood.com/2010/2/JavaScript-Scoping-and-Hoisting">scope and hoisting</a> in Javascript. The more I learn Javascript, the more I like this <a href="https://www.destroyallsoftware.com/talks/wat">wired</a> but powerful language.</p>

<h2>Movies</h2>

<p>I watch the movie <em><a href="http://www.imdb.com/title/tt1772341/">Wreck-It Ralph</a></em>, and as it is already  end of December now, I think this is the best movie I have watched this year.</p>

<h2>Trello</h2>

<p>I got to know trello maybe 2 months ago, when I read the <a href="https://www.blossom.io/blog/2012/09/17/3-tips-for-quick-effective-stand-up-meetings.html">post</a> about standup meeting, and learned things about Kanban. But I started to try <a href="https://trello.com">Trello</a> just resently. Because of this <a href="http://accidentalhacker.com/post/37883161398/rocking-gtd-with-trello">blog post</a>, I haves tried to use Trello to do some GTD work, and it is wonderful. It&rsquo;s clear and simple to use, very good website design, I want to transfer most of my Emacs-Todo-Agenda into Trello Board and tasks, it helps me a lot on GTD.</p>

<h2>Last Weekend</h2>

<p>Last weekend, I did what I wanted to do long ago.</p>

<ol>
<li>Reinstall my desktop to Windows 7 and wipe Windows 8, I seem not love Win8 that much and I need Win7 to flush my Android.</li>
<li><a href="http://forum.xda-developers.com/showthread.php?t=1859714">Flush</a> HTC One X back to stock, thought I might broke my phone, but finally found a <a href="http://forum.xda-developers.com/showthread.php?t=1658084&amp;nocache=1">solution</a> to charge my phone on fast boot mode. Thank God for that post, Now I have upgraded to Android 4.1 Jelly Bean with Sense 4. It is Great!</li>
<li>Install <a href="https://fedoraproject.org/en/get-prerelease">Fedora 18 Beta</a>, it&rsquo;s much better than I imagine, the installer is beautiful, Gnome 3.6 has much change and I want to use it to replace Ubuntu in my office after it <a href="https://fedoraproject.org/wiki/Schedule">released</a> in Jan 8.</li>
<li>Hangout with friends and have a long talk in KFC…</li>
</ol>


<h2>Next</h2>

<p>The things I want to do in next month:</p>

<ol>
<li>learn more about node.js</li>
<li>learn <a href="http://visionmedia.github.com/mocha/">mocha</a> and <a href="http://coffeescript.org/">CoffeeScript</a></li>
<li>See friends in Shenzhen at New year holiday, it&rsquo;s just this Saturday, Yeah!</li>
<li>Plan my trip to Tokyo, I&rsquo;m looking forward to this ^ ^</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Restore Ubuntu grub2 after install Windows]]></title>
    <link href="http://laputa.io/blog/2012/10/16/restore-ubuntu-grub2-after-install-windows/"/>
    <updated>2012-10-16T20:06:00+09:00</updated>
    <id>http://laputa.io/blog/2012/10/16/restore-ubuntu-grub2-after-install-windows</id>
    <content type="html"><![CDATA[<p>A two weeks ago, I have installed Windows 8 on my home desktop to replace Windows 7, and of cause I can not boot into Ubuntu 12.04 after that. Today I got my Ubuntu live USB stick back from one of my friend, so I try to restore grub2 in Ubuntu. Here is the work flow:</p>

<!--more-->


<p>Boot into the Ubuntu liveUSB, and choose <strong>Try Ubuntu</strong> instead of install it.</p>

<p>Open terminal, mount necessary device:</p>

<pre><code>$ sudo mount /dev/sdx /mnt
$ sudo mount --bind /dev /mnt/dev
$ sudo mount --bind /proc /mnt/proc
</code></pre>

<p><code>/dev/sdx</code> ==> replace <code>x</code> with the device where your old ubuntu lies in.</p>

<p>Then we can change root to the old ubuntu directory:</p>

<pre><code>$ sudo chroot /mnt
</code></pre>

<p>use <a href="http://www.gnu.org/software/grub/manual/html_node/Installing-GRUB-using-grub_002dinstall.html">grub-install</a> to reinstall grub2:</p>

<pre><code># grub-install --recheck /dev/sdx
Installation finished. No error reported.
</code></pre>

<p>Now we need to <strong>reboot</strong>, and now we can see the ubuntu grub boot window, and boot into Ubuntu</p>

<p>Open terminal, use <code>update-grub2</code> to detect your windows installation:</p>

<pre><code>$ sudo update-grub2
</code></pre>

<p>This will find the windows installation and add it to grub2 boot entry.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Switch to octpress]]></title>
    <link href="http://laputa.io/blog/2012/10/14/switch-to-octpress/"/>
    <updated>2012-10-14T00:09:00+09:00</updated>
    <id>http://laputa.io/blog/2012/10/14/switch-to-octpress</id>
    <content type="html"><![CDATA[<p>Trying to switch blog generator from pelican to octpress.</p>

<p>And I have created a little ruby script to convert pelican markdown post to octpress post. Which actually converts the post head like:</p>

<!--more-->


<p>In pelican:</p>

<pre><code>Date: 2012-09-02    
Title: Using Awesome in Ubuntu 12.04  
Category: Dev  
Tags: ubuntu, awesome, wm, linux  
Slug: awesome-on-ubuntu
Lang: en  
Author: laputa  
</code></pre>

<p>to in Octpress:</p>

<pre><code>---
layout: post
title: "Using Awesome in Ubuntu 12.04"
date: 2012-09-02
comments: true
categories: Dev
tags: [ubuntu, awesome, wm, linux]
---
</code></pre>

<p>and also copy the file to YYYY-MM-DD-Title.markdown as Jekyll requires.</p>

<p>Here is the script, a little ugly, but can be used:</p>

<p><code>convert.rb:</code></p>

<pre><code>#!/usr/bin/env ruby

require 'fileutils'

tmpFile = open("tmp-file", "w")
tmpFile.puts "---"
tmpFile.puts "layout: post"

open(ARGV[0]) { |file|
  inHead = true
  inContent = false
  date = "2012-10-14"
  title = "tmp-file"
  categories = "dev"
  tags = ""
  file.readlines.each{ |line|
    if line.start_with?("Date:")
      date = line.split(":")[1].strip
    elsif line.start_with?("Title:")
      title = line.split(":")[1].strip
    elsif line.start_with?("Category:")
      categories = line.split(":")[1].strip
    elsif line.start_with?("Tags:")
      tags = line.split(":")[1].strip
    elsif line.match(/^[A-Z][a-z]+: [^:]+$/)
    else
      inHead = false
    end

    if ! inHead &amp;&amp; ! inContent
      tmpFile.puts "title: \"#{title}\""
      tmpFile.puts "date: #{date}"
      tmpFile.puts "comments: true"
      tmpFile.puts "categories: #{categories}"
      tmpFile.puts "tags: [#{tags}]"
      tmpFile.puts "---"

      inContent = true
    end

    if ! inHead &amp;&amp; inContent
      tmpFile.puts line
    end
  }

  tmpFile.close

  FileUtils.mv "tmp-file", "#{date}-#{title.downcase.split.join("-")}.markdown"
}
</code></pre>

<p>I use this command to convert all my pelican <code>*.md</code> files to octpress <code>*.markdown</code> files:</p>

<pre><code>find . -name "*.md" | xargs -n 1 ./convert.rb
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Weekly Review for Sep.16 2012]]></title>
    <link href="http://laputa.io/blog/2012/09/16/weekly-review-for-sep.16-2012/"/>
    <updated>2012-09-16T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/09/16/weekly-review-for-sep.16-2012</id>
    <content type="html"><![CDATA[<p>I think now I can only do this review twice a week.</p>

<p>No efficiency for the last two weeks, and I have left many things undone. Mainly because I always got a headache on the weekends, and can not do any job in front of a computer. I think I have not sleep well these two weeks, I need to adjust my body clock back normal&hellip;</p>

<!--more-->


<h3>Things I have done for the last two weeks:</h3>

<h4>Life:</h4>

<ul>
<li>[ ] see friends</li>
</ul>


<h4>Hack</h4>

<ul>
<li>[x] config awesome in Ubuntu</li>
<li>[x] learn jstd &amp; jasmine</li>
<li>[x] try cloud foundry</li>
<li>[ ] kollekt information about command line tips</li>
<li>[x] try multiple firefox instance</li>
<li>[x] try to use Firefox Aurora on Ubuntu</li>
<li>[ ] collect thoughts about RequireJS, Jstd &amp; Jasmine</li>
<li>[ ] configure Emacs for Javascript</li>
</ul>


<h3>Plan for next week?</h3>

<p>  Still headache now, can not decide yet.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Running multiple instance of firefox]]></title>
    <link href="http://laputa.io/blog/2012/09/13/running-multiple-instance-of-firefox/"/>
    <updated>2012-09-13T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/09/13/running-multiple-instance-of-firefox</id>
    <content type="html"><![CDATA[<p>  I&rsquo;m doing web development nowadays, using <a href="http://www.mozilla.org/en-US/firefox">Firefox</a>, still my favorite browser and develop platform, though I will also use <a href="http://www.google.com/chrome">Chrome</a> some time.</p>

<!--more-->


<p>  As you may know that firefox does not allow multiple instance to run at the same time, which means if you try to open firefox again(with desktop shortcut or command line) when you already is running one, it will give a message saying:</p>

<blockquote><p>A copy of Firefox is already open. Only one copy of Firefox can be open at a time.</p></blockquote>

<p>  A very long time before, I had wanted to run multiple fireboxes at the same time, but no lucky. Until yesterday I read a <a href="http://www.callum-macdonald.com/about/faq/multiple-firefox-instances/">blog post</a> in my <a href="www.google.com/reader">google reader</a>, I see this feature again. And what&rsquo;s lucky that I decide to try it. What I get is more than I wanted.</p>

<p>  So, here is how to do it:</p>

<p>  First, we need to know something about firefox&rsquo;s command line options(running on Mac OSX with ff 15.0.1):</p>

<pre><code>$ firefox --help
Firefox options
-h or -help        Print this message.
-v or -version     Print Firefox version.
-P &lt;profile&gt;       Start with &lt;profile&gt;.
-migration         Start with migration wizard.
-ProfileManager    Start with ProfileManager.
-no-remote         Do not accept or send remote commands; implies -new-instance.
-new-instance      Open new instance, not a new window in running instance.
-UILocale &lt;locale&gt; Start with &lt;locale&gt; resources as UI Locale.
-safe-mode         Disables extensions and themes for this session.
-jsconsole         Open the Error console.
-browser           Open a browser window.
-new-window  &lt;url&gt; Open &lt;url&gt; in a new window.
-new-tab     &lt;url&gt; Open &lt;url&gt; in a new tab.
-preferences       Open Preferences dialog.
-search     &lt;term&gt; Search &lt;term&gt; with your default search engine.
-private           Enable private browsing mode.
-private-toggle    Toggle private browsing mode.
-setDefaultBrowser Set this app as the default browser.
</code></pre>

<p> but today we only need this three:</p>

<ul>
<li><p>-no-remote<br/>
Enables <a href="http://kb.mozillazine.org/Opening_a_new_instance_of_your_Mozilla_application_with_another_profile">running multiple instances of the application with different profiles</a>; used with -P</p></li>
<li><p>-ProfileManager<br/>
Starts with Profile Manager.</p></li>
<li><p>-P &ldquo;&lt;profile name>&#8221;<br/>
Starts with a given profile name (profile name is case sensitive).</p></li>
</ul>


<p>first running firefox with <code>-ProfileManager</code>, let&rsquo;s create a separate profile:</p>

<pre><code>$ firefox -ProfileManager
</code></pre>

<p>this will open a dialog to let us create/delete/rename profiles, just create a new one, and name it. like <code>develop</code>.</p>

<p>  Then run firefox normally, like we always did after open the computer. Now firefox is running with the default profile, and if we open it again, it will give the normal <code>Only one instance</code> warning. Let&rsquo;s do it in command line way:</p>

<pre><code>$ firefox -no-remote -P "develop"
</code></pre>

<p>  Da da!! Now we have two firefox, in <em><strong>separate instance</strong></em>. Which also means <strong>double memory use..</strong></p>

<p>  You may ask, what&rsquo;s the point? Why we need two instance of firefox? Two make two cups of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=46647">coffee</a>? Well, let me tell you what this is worth a blog post.</p>

<p>  The point is not only another instance of firefox, but also a separate <strong>Profile</strong>. As I use firefox every day and keep it open from opening the computer till leaving office. I use it to read mails, review code, check new issues, search google, etc. And also, I use it to develop, test website, open firebug, debug javascript, etc. Currently I am doing this all in a single firefox window, and some times firebug makes my FF very slow, it influence my other work.</p>

<p>  Now, with this profile manager, I can make a new clean profile, with only develop add-ons installed, and open another firefox instance, only use it to do web development, doesn&rsquo;t this sounds awesome?! What&rsquo;s more, we can set up shortcuts for this <em>clean development</em> firefox instance, and open it in another workspace, without influence my daily web works. I will do this in my <a href="http://awesome.naquadah.org/">awesome</a> configuration file of Ubuntu 12.04 after I go to office tomorrow. It will be interesting, and later I will try <a href="www.mozilla.org/en-US/firefox/aurora/">Firefox 17</a>&rsquo;s new <a href="https://hacks.mozilla.org/2012/09/html-editing-and-other-improvements-in-firefox-17-developer-tools/">web development tools</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Weekly Review for Sep.2 2012]]></title>
    <link href="http://laputa.io/blog/2012/09/02/weekly-review-for-sep.2-2012/"/>
    <updated>2012-09-02T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/09/02/weekly-review-for-sep.2-2012</id>
    <content type="html"><![CDATA[<p>I have using Emacs to organize my daily plan for the last two weeks, and now I&rsquo;d like to record my weekly todo plans with it.</p>

<p>I learned this from <a href="http://sachachua.com/blog/2012/09/weekly-review-week-ending-august-31-2012/">sachachua&rsquo;s blog</a>, and she has some wonderful posts about Emacs org-mode.</p>

<!--more-->


<h3>Things I have done in the last two weeks:</h3>

<h4>Life</h4>

<ul>
<li>[x] have a party with colleagues</li>
<li><p>[x] clean up my github repos</p></li>
<li><p>[x] pay my credit card</p></li>
<li>[x] clean my kitchen</li>
<li>[x] Watch Batman: Dark knight raises</li>
<li>[ ] Make my 900-month life grid card</li>
</ul>


<h5>Hack</h5>

<ul>
<li>[ ] update Emacs org-mode to latest version</li>
<li>[x] add fav icon to my github blog</li>
<li>[x] add travis build files for my github project Yaml2Properties</li>
<li>[x] learn org-mode</li>
<li>[x] learn org agenda, capture mode</li>
<li>[x] Install Awesome in Ubuntu</li>
<li>[x] write a weekly review</li>
</ul>


<h3>Plans for the next week</h3>

<h4>Hack</h4>

<ul>
<li>[ ] Learning Accounting software, maybe ledger</li>
<li>[ ] try cloudfontry, find a place to put my blog</li>
<li>[ ] try to use Octpress to generate my blog</li>
<li>[ ] tweak my awesome config in Ubuntu[</li>
</ul>


<h4>Life</h4>

<ul>
<li>[ ] see friends</li>
<li>[ ] plan for my long holiday</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Awesome in Ubuntu 12.04]]></title>
    <link href="http://laputa.io/blog/2012/09/02/using-awesome-in-ubuntu-12.04/"/>
    <updated>2012-09-02T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/09/02/using-awesome-in-ubuntu-12.04</id>
    <content type="html"><![CDATA[<p>I have used <a href="http://www.ubuntu.com/">Ubuntu</a> <a href="http://releases.ubuntu.com/12.04/">12.04</a> for about 1.5 months, and now I&rsquo;m very happy to use it, as I started Linux by <a href="http://fedoraproject.org/">Fedora</a>, and tried many other major <a href="http://distrowatch.com/">distributions</a>, my last distribution was <a href="http://www.gentoo.org/">Gentoo</a>, and I like it very much, still now. After I graduate from school and start my first job, I&rsquo;m very glad that my employer does not care what OS I use, so I can continue using Linux, and this time I choose to try Ubuntu, which I have not used too much before.</p>

<!--more-->


<p>Till now, I have used it for nearly two month, and I&rsquo;m happy now. It is simple, <a href="http://unity.ubuntu.com/">Unity</a> is well designed, and it does not influence my work experience, I like it. Of cause I did some <a href="http://justlaputa.github.com/2012/07/install-ubuntu-en.html">tweak to Ubuntu</a> to fit my habit, like disable some keybindings.</p>

<p>But recently, I started to miss one thing, which is the <a href="http://awesome.naquadah.org/">awesome</a> window manager, I miss the <strong><code>Win + n</code></strong> workspace switch shortcut, and I miss it so much. Especially after I have buy a <a href="http://justlaputa.github.com/2012/08/buy-hhkb.html">HHKB</a> lately, and I have to press 4 keys(<strong><code>Fn + Ctrl + Alt + Arrow</code></strong>) to switch workspace in Ubuntu Unity, though I have practiced my finger, but I miss awesome so much and plan to use it in ubuntu. And luckily it is easy.</p>

<p>Here is my experience about install and config awesome in <strong>Ubuntu 12.04</strong>.</p>

<h2>install awesome</h2>

<p>awesome is already in Ubuntu&rsquo;s package source, install it by apt-get:</p>

<pre><code>$ sudo apt-get install awesome
</code></pre>

<p>so it is easy, isn&rsquo;t it? Let&rsquo;s try it.</p>

<p>logout from ubuntu, and you will get to the <a href="http://wiki.freedesktop.org/wiki/Software/LightDM">lightdm</a> login screen, and click the cycle icon besides your use name, a ha, we get a list of all available sessions to login, and of cause awesome is in the list. So choose <strong>awesome</strong> as the session, and type your password to login. Now you can see the awesome windows manager, yes, it&rsquo;s cool.</p>

<p>But wait, let do some config to get it more beautiful.</p>

<h2>config awesome</h2>

<p>There are many config examples in <a href="http://awesome.naquadah.org/wiki/User_Configuration_Files">awesome wiki</a>, and currently I&rsquo;m using the <a href="http://awesome.naquadah.org/wiki/Vicious">vicious</a> configuration files, you can get it from it&rsquo;s <a href="http://git.sysphere.org/">git repo</a>.</p>

<pre><code>$ cd ~/src
$ git clone http://git.sysphere.org/awesome-configs
$ git clone http://git.sysphere.org/vicious
$ cp -r awesome-configs ~/.config/awesome
$ cp -r vicious ~/.config/awesome/
</code></pre>

<p>Now we have set the config files, lets reload awesome to see it. <strong>Right click</strong> no the desktop, choose <em>restart</em> to let awesome reload the configuration files. Da da, now we are really in awesome. All the configuration is write in <code>~/.config/awesome/rc.lua</code>, and we can see all the key shortcut in it.</p>

<h2>tweak Ubuntu</h2>

<p>We are not done yet, though we have a beautiful WM to use now, but there are still something we need to do.</p>

<h3>disable desktop background</h3>

<p>Try to open <a href="https://live.gnome.org/Nautilus">Nautilus</a> by pressing <strong><code>Alt + F2</code></strong>, you will see the Ubuntu desktop background show up, and the top task bar is gone, so we need to fix this first.</p>

<p>Install <a href="https://live.gnome.org/GnomeTweakTool">Gnome-tweak-tool</a>:</p>

<pre><code>$ sudo apt-get install gnome-tweak-tool
</code></pre>

<p>and open it, disable <strong><code>Desktop-&gt;Have file manager handle the desktop</code></strong>, now restart awesome, this time open <strong>Nautilus</strong> is ok.</p>

<h3>auto start gnome-session</h3>

<p>We need to use some gnome service in awesome, like <a href="http://projects.gnome.org/NetworkManager/">Network Manager</a> and <a href="https://live.gnome.org/GnomeKeyring">Gnome keyring</a>, so let&rsquo;s add it to awesome&rsquo;s init file:</p>

<pre><code>$ vim ~/.config/awesome/rc.lua
# add to bottom
exec("gnome-keyring-daemon --daemonize --login")
exec("gnome-session --session=ubuntu")
</code></pre>

<p>How do I know this? Re-choose <strong>Ubuntu</strong> session when you login, and using <a href="http://htop.sourceforge.net/">htop</a> to see process tree, you will see what&rsquo;s running behind a gnome session, choose the one you like and add it to <code>rc.lua</code>.</p>

<h3>fix the maximize problem</h3>

<p>Some program(like gnome-terminal) can not be really maximized when pressing <strong><code>Win + m</code></strong>, add this to <code>rc.lua</code> will fix this:</p>

<pre><code>size_hints_honor = false
</code></pre>

<h2>Finally</h2>

<p>I&rsquo;m having fun now. I&rsquo;ll add more tips if I find something cool.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs Raises]]></title>
    <link href="http://laputa.io/blog/2012/08/30/emacs-raises/"/>
    <updated>2012-08-30T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/30/emacs-raises</id>
    <content type="html"><![CDATA[<p>以前读研究生的时候一直用Emacs，工作后好久没用，本来都以为自己快忘了，后来在公司电脑装了Ubuntu，终于开始重新用上Emacs了，依旧很爽。</p>

<p>慢慢捡起Emacs，才发现有些东西是永远都忘不了的，Emacs的快捷键已经深入骨髓了，前段时间我折腾了下<a href="http://justlaputa.github.com/2012/08/eclipse-emacs-en.html">Eclipse</a>，把Eclipse改造成了Emacs，还是相当成功的，我现在用Eclipse很嗨，当然还是有大部分时间是用Emacs的。</p>

<!--more-->


<p>加上前段时间入的<a href="http://elitekeyboards.com/products.php?sub=pfu_keyboards,hhkbpro2&amp;pid=pdkb400b">HHKB</a>，上周<a href="http://justlaputa.github.com/2012/08/buy-hhkb.html">到手了</a>，用了一个星期，简直乃<strong>神器</strong>也，配合Emacs的快捷键相当不错，除了<em>&lsquo;~&rsquo;</em> 键键位比较奇怪外，其他没有啥缺陷。手感比我之前用的Filco 87 忍者青轴要好，PBT键帽手感很舒服，让人有一种想写代码的冲动，哈哈。</p>

<p>最近重新开始学习Emacs <a href="http://orgmode.org/">Org-mode</a>，用org-agenda做<a href="http://en.wikipedia.org/wiki/Getting_Things_Done">GTD</a>，虽然花了不少时间，但确实提高了做事情的效率，让我对事情更有计划了，以后一定坚持，慢慢学更多的东西。还好公司有咖啡机，不然可能我会考虑用Emacs <a href="http://www.emacswiki.org/emacs/CoffeeMode">煮咖啡</a> :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FFmpeg Practice Commands]]></title>
    <link href="http://laputa.io/blog/2012/08/26/ffmpeg-practice-commands/"/>
    <updated>2012-08-26T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/26/ffmpeg-practice-commands</id>
    <content type="html"><![CDATA[<!--more-->


<h2>Convert video for HTC Desire by FFmpeg</h2>

<pre><code>ffmpeg -i inputfile.mpg \
-aspect 16:9 -s 800x480 \
-vcodec libx264 -b 480k -vpre slow_firstpass -vpre baseline -r 13 \
-acodec libfaac -ab 128k -sameq \
-pass 1 -f rawvideo -an -y /dev/null &amp;&amp; \
ffmpeg -i inputfile.mpg \
-aspect 16:9 -s 800x480 \
-vcodec libx264 -b 480k -vpre slow -vpre baseline -r 13 \
-acodec libfaac -ab 128k -ac 2 -sameq \
-pass 2 outputfile.mp4

ffmpeg -y -i Pixar.Short.Films.Collection.2008.Presto.1080p.BluRay.x264.AC3-WiKi.mkv  -s 800x450 -aspect 16:9 -r 24000/1001 -b 480k -vcodec libx264 -pass 1 -vpre fast_firstpass -vpre baseline -an -f rawvideo /dev/null &amp;&amp; ffmpeg -y -i Pixar.Short.Films.Collection.2008.Presto.1080p.BluRay.x264.AC3-WiKi.mkv -s 800x450 -aspect 16:9 -r 24000/1001 -b 480k -vcodec libx264  -vpre slow -vpre baseline -acodec libfaac -ar 32k -ab 128k -ac 2 -sameq -pass 2 out.mp4

ffmpeg -y -i Pixar.Short.Films.Collection.2008.Presto.1080p.BluRay.x264.AC3-WiKi.mkv  -s 320x180 -vf pad=320:240:0:30 -r 24000/1001 -b 240k -vcodec libx264 -pass 1 -vpre fast_firstpass -vpre baseline -an -f rawvideo /dev/null &amp;&amp; ffmpeg -y -i Pixar.Short.Films.Collection.2008.Presto.1080p.BluRay.x264.AC3-WiKi.mkv -s 320x180 -vf pad=320:240:0:30 -r 24000/1001 -b 240k -vcodec libx264  -vpre slow -vpre baseline -acodec libfaac -ar 32k -ab 128k -ac 2 -sameq -pass 2 out_320x240.mp4
</code></pre>

<h2>keep ratio</h2>

<p>  ffmpeg -filters:</p>

<p>  Pad input image to width:height[:x:y[:color]] (default x and y: 0, default color: black). from 1920x1080 to 800x480</p>

<pre><code>ffmpeg -i in -s 800x450 -vf pad=800:480:0:15 out
</code></pre>

<h2>tricks</h2>

<ul>
<li><p> grab screen</p>

<pre><code>ffmpeg -f x11grab -r 25 -s wxga -i :0.0 /tmp/outputFile.mpg
</code></pre></li>
<li><p> extrac image</p>

<p>   1 image per second(default is 25 without -r)</p>

<pre><code>ffmpeg -i test.mpg -r 1 image%d.jpg
</code></pre></li>
<li><p> image to video</p>

<pre><code>ffmpeg -f image2 -i img%d.jpg /tmp/a.mpg
</code></pre></li>
<li><p> capture from cam and mic</p>

<pre><code>ffmpeg -f oss -i /dev/dsp -f video4linux2 -s 320x240 -i /dev/video0 out.mpg
</code></pre></li>
</ul>


<h2>configure options</h2>

<ul>
<li><p> install:</p>

<p>  dependence: yasm faad2-devel faac-devel lame-devel opencore-amr-devel openjpeg-devel libtheora-devel libvpx-devel libvorbis-devel xvidcore-devel</p>

<pre><code>./configure --prefix=/usr --disable-static --enable-shared --enable-gpl --enable-version3 --enable-nonfree --enable-postproc --enable-x11grab --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfaac --enable-libmp3lame --enable-libopenjpeg --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libxvid --disable-debug

(optional) --enable-libvo-aacenc --enable-libvo-amrwbenc

make &amp;&amp; sudo make install
</code></pre></li>
<li><p> build &amp; install libx264</p>

<pre><code>./configure --prefix=/usr --enable-shared
make &amp;&amp; sudo make install
</code></pre></li>
<li><p> reconfigure ffmpeg add &mdash;enable-libx264</p>

<pre><code>make &amp;&amp; make 
</code></pre></li>
</ul>


<h2>install libvo-aacenc libvo-amrwbenc</h2>

<ul>
<li><p> get from opencore-amr sourceforge</p></li>
<li><p> install:</p>

<pre><code>$ autoreconf
$ ./configure
$ make &amp;&amp; sudo make install
</code></pre></li>
</ul>


<h2>output rtp</h2>

<pre><code>ffmpeg -re -i ~/Videos/test/Ice.Age.Continental.Drift_CIF_352x288.mp4 \
-an -vcodec libx264 -r 20 -g 45 -s 352x288 -deinterlace -f rtp rtp://127.0.0.1:9012 \
-vn -acodec libfaac -ac 2 -ab 192k -ar 44100 -async 1 -flags +global_header -f rtp rtp://127.0.0.1:9014rtp://127.0.0.1:9014
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs Tips&Tricks]]></title>
    <link href="http://laputa.io/blog/2012/08/26/emacs-tips-tricks/"/>
    <updated>2012-08-26T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/26/emacs-tips-tricks</id>
    <content type="html"><![CDATA[<!--more-->


<p>  delete ^M with emacs</p>

<pre><code>M-x replace-string &lt;RET&gt; C-q C-m &lt;RET&gt; &lt;RET&gt;
</code></pre>

<p>  save backup files elsewhere</p>

<pre><code>(defvar user-temporary-file-directory
  (concat temporary-file-directory user-login-name "/"))
(make-directory user-temporary-file-directory t)
(setq backup-by-copying t)
(setq backup-directory-alist
      `(("." . ,user-temporary-file-directory)
        (,tramp-file-name-regexp nil)))
(setq auto-save-list-file-prefix
      (concat user-temporary-file-directory ".auto-saves-"))
(setq auto-save-file-name-transforms
      `((".*" ,user-temporary-file-directory t)))
</code></pre>

<p>  open file as root</p>

<p>  using tramp, see tramp manual</p>

<pre><code>C-x C-f /su::/etc/passwd
</code></pre>

<p>  replace with a newline</p>

<pre><code>M-x replace-string ; C-q C-j
</code></pre>

<p>  kill all buffers</p>

<pre><code>M-x kill-some-buffers
</code></pre>

<p>  save all buffers</p>

<pre><code>C-x s
</code></pre>

<p>  insert comment</p>

<p>  select region to comment:</p>

<pre><code> M-;
</code></pre>

<p>  <a href="http://www.cs.ucf.edu/~leavens/emacs/ecb/html-help/Setting-up-semantic.html">disable red underline</a></p>

<pre><code>(global-semantic-show-unmatched-syntax-mode -1)
</code></pre>

<p>  Swap caps lock &amp; ctrl</p>

<pre><code>$ vim ~/.Xmodmap
remove Lock = Caps_Lock
remove Control = Control_L
keysym Control_L = Caps_Lock
keysym Caps_Lock = Control_L
add Lock = Caps_Lock
add Control = Control_L
</code></pre>

<p>  insert date</p>

<pre><code>C-u M-! date
M-1 M-! date
</code></pre>

<p>  show whitespace</p>

<pre><code>M-x whitespace-mode
</code></pre>

<p>  keybord macros</p>

<pre><code>C-x (     -&gt;start macro
key sequence
C-x )     -&gt;stop macro
C-x e     -&gt;execute macro
C-u N C-x e -&gt; N times
</code></pre>

<p>  replace tabs with spaces</p>

<pre><code>M-x untabify
</code></pre>

<p>  vice versa:</p>

<pre><code>M-x tabify
</code></pre>

<p>  <a href="http://www.delorie.com/gnu/docs/emacs/emacs_68.html">multi-line edit</a></p>

<p>  mark a region then:</p>

<pre><code>C-x r t
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacs Org-mode Cheat Sheet]]></title>
    <link href="http://laputa.io/blog/2012/08/26/emacs-org-mode-cheat-sheet/"/>
    <updated>2012-08-26T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/26/emacs-org-mode-cheat-sheet</id>
    <content type="html"><![CDATA[<!--more-->


<h2>Keybindings</h2>

<h3>General</h3>

<pre><code>| Visibility cycling    |                                                 |
| &lt;TAB&gt;                 | Rotate current subtree                          |
| S-&lt;TAB&gt; and C-u &lt;TAB&gt; | Rotate entire buffer                            |
| C-u C-u C-u &lt;TAB&gt;     | Show all                                        |
|-----------------------+-------------------------------------------------|
| Move between heading  |                                                 |
| C-c C-n               | Next heading                                    |
| C-c C-p               | Previous Heading                                |
| C-c C-f               | Next heading same level                         |
| C-c C-b               | Previous Heading same level                     |
| C-c C-u               | Backward to higher level heading                |
|-----------------------+-------------------------------------------------|
| Structure editing     |                                                 |
| M-&lt;RET&gt;               | Insert new heading with same level as current   |
| M-S-&lt;RET&gt;             | Insert new TODO entry                           |
| &lt;TAB&gt;                 | Cycle through levels in empty entry             |
| M-&lt;left&gt;/&lt;right&gt;      | Promote/demote current heading by one level     |
| M-S-&lt;left&gt;/&lt;right&gt;    | Promote/demote current subtree by one level     |
| M-S-&lt;up&gt;/&lt;down&gt;       | Move subtree up/down                            |
| C-c C-w               | Refile entry or region to different location    |
| C-x n s/w             | Narrow buffer to current subtree/widen it again |
|-----------------------+-------------------------------------------------|
| Sparse trees          |                                                 |
| C-c /                 |                                                 |
| C-c / r               |                                                 |
|-----------------------+-------------------------------------------------|
| Plain lists           |                                                 |
| '-' '+' '*'           | Unordered list                                  |
| '1.' '1)'             | Ordered list                                    |
| '::'                  | Description list                                |
| &lt;TAB&gt;                 | Fold items                                      |
| M-&lt;RET&gt;               | Insert new items                                |
| M-S-&lt;RET&gt;             | Insert new items with a checkbox                |
| M-S-&lt;up&gt;/&lt;down&gt;       | Move item up/down                               |
| M-&lt;left&gt;/&lt;right&gt;      | Decrease/increase indentation of item           |
| M-S-&lt;left&gt;/&lt;right&gt;    | Decrease/increase including subitems            |
| C-c C-c               | Toggle checkbox                                 |
| C-c -                 | Cycle item bullets('-','+','*','1.','1)')       |
|-----------------------+-------------------------------------------------|
| Footnotes             |                                                 |
| C-c C-x f             | Footnote action command                         |
| C-c C-c               | Jump between definition and reference           |
|-----------------------+-------------------------------------------------|
</code></pre>

<h3>Tables</h3>

<pre><code>| C-c |                        | convert and active region to table, create new table if no active region |
| C-c C-c                      | Re-align table without moveing the cursor                                |
| &lt;TAB&gt;                        | Re-align and move to next field                                          |
| S-&lt;TAB&gt;                      | Re-align and move to previous field                                      |
| &lt;RET&gt;                        | Re-align and move down to next row                                       |
|------------------------------+--------------------------------------------------------------------------|
| Column and row editing       |                                                                          |
| M-&lt;left&gt;/&lt;right&gt;             | Move current column left/right                                           |
| M-S-&lt;left&gt;                   | Kill current column                                                      |
| M-S-&lt;right&gt;                  | Insert new column to the left of cursor                                  |
| M-&lt;up&gt;/&lt;down&gt;                | Move current row up/down                                                 |
| M-S-&lt;up&gt;                     | Kill current row                                                         |
| M-S-&lt;down&gt;                   | Insert new row above current                                             |
| C-c -                        | Insert horizontal line below current                                     |
| C-c &lt;RET&gt;                    | Insert horizontal line below and move to it                              |
| C-c ^                        | Sort table lines                                                         |
</code></pre>

<h3>Hyperlinks</h3>

<pre><code>| C-c l   | Store a link                                |
| C-c C-l | Insert a link                               |
| C-c C-l | Edit links when cursor on the link          |
| C-c C-o | Open link                                   |
| C-c &amp;   | Jump back to recorded position(Using C-c %) |
</code></pre>

<h3>TODO Items</h3>

<pre><code>| C-c C-t          | Rotate TODO states               |
| S-&lt;right&gt;/&lt;left&gt; | Select following/preceding state |
| C-c / t          | View TODO items in sparse tree   |
| C-c a t          | Show global TODO list            |
| S-M-&lt;RET&gt;        | Insert new TODO entry            |
| C-c ,            | Set priority                     |
| S-&lt;up&gt;/&lt;down&gt;    | Increase/decrease priority       |
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Eclipse & Emacs]]></title>
    <link href="http://laputa.io/blog/2012/08/08/eclipse-emacs/"/>
    <updated>2012-08-08T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/08/eclipse-emacs</id>
    <content type="html"><![CDATA[<p>This post is about how I tweak Eclipse into a Emacs like IDE, and now I&rsquo;m very happy using Eclipse.</p>

<!--more-->


<h2>Emacs Key-bindings</h2>

<p>  I just got to know that Eclipse has a built in <a href="http://help.eclipse.org/juno/index.jsp?topic=%2Forg.eclipse.platform.doc.user%2Fconcepts%2Faccessibility%2Fkeyboardshortcuts.htm">Emacs key-binding scheme</a>, just set it like this:</p>

<pre><code>Windows-&gt;Preference-&gt;General-&gt;Keys-&gt;Scheme-&gt;Emacs
</code></pre>

<p>  has most useful key-bindings, like <em>C-a</em>, <em>C-e</em>, <em>C-x C-s</em>, etc. But Set Mark does not work with <em>C-Space</em></p>

<h2>Emacs+ plugin for Eclipse</h2>

<p>  Install <a href="http://marketplace.eclipse.org/content/emacs">Emacs+</a> from Eclipse Marketplace, and see the tutorial on <a href="http://www.mulgasoft.com/">MulgaSoft</a>
  Note that Emacs+ does not support Eclipse Juno(4.2), so if you want to use Emacs+, you better change back to Indigo(3.7) like me&hellip;</p>

<p>  It&rsquo;s awesome, now Set Mark and Select Text works in Eclipse.</p>

<h2>Menu bar integration with Ubuntu Unity</h2>

<p>  This is amazing, just do as this <a href="http://elvisd.blogspot.hk/2012/01/enable-eclipse-global-menu-integration.html">blog post</a> says, and you can move the eclipse menu bar to Ubuntu global menu area.</p>

<pre><code>$ sudo vim /usr/lib/gtk-2.0/2.10.0/menuproxies/libappmenu.so
/Eclipse
# Replace 'E' with 'X'
Eclipse -&gt; Xclipse
# Save &amp;&amp; Exit
$ sudo ldconfig
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JQuery .val() function]]></title>
    <link href="http://laputa.io/blog/2012/08/07/jquery-val-function/"/>
    <updated>2012-08-07T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/07/jquery-val-function</id>
    <content type="html"><![CDATA[<h1>JQuery 的 .val() 函数</h1>

<p>最近开始学习<a href="http://jquery.com/">JQuery</a>，用的过程中发现 <a href="http://api.jquery.com/val/">.val()</a> 函数有些奇怪，于是研究了一下，收获不少。</p>

<!--more-->


<h2>.val() API</h2>

<p>根据 JQuery <a href="http://api.jquery.com">api文档</a> 的描述，.val() 函数有两种用法，分别用来获取或设置元素的值，这里只介绍获取值的方法。</p>

<p>文档里面说 .val 主要是用于获取元素的value，比如 <a href="http://www.w3schools.com/tags/tag_input.asp">input</a>, <a href="http://www.w3schools.com/tags/tag_select.asp">select</a> 和 <a href="http://www.w3schools.com/tags/tag_textarea.asp">textarea</a>等，首先第一个问题，&#8221;什么是元素的<strong>value</strong>?&#8221;</p>

<p>用 <em>select</em> 标签为例，如下的代码：</p>

<pre><code>&lt;select id="choise"&gt;
    &lt;option&gt;One&lt;/option&gt;
    &lt;option&gt;Two&lt;/option&gt;
    &lt;option&gt;Three&lt;/option&gt;
    &lt;option&gt;Four&lt;/option&gt;
&lt;/select&gt;
&lt;p id="result"&gt;&lt;/p&gt;

$('#choise').click(function(event) {
    $('#result').html($(this).val());
});
</code></pre>

<p>可以在<a href="http://jsfiddle.net/">jsfiddle</a>上运行<a href="http://jsfiddle.net/justlaputa/NGzDD/">这段代码</a>试试。这段代码跟 jquery 官方文档上所给的例子一样，可以看到在 <em>select</em> 标签所表示的对象上调用 <strong>.val()</strong> 方法，得到的是被选中的 <em>option</em> 的值，所以在选择的时候，下面显示的是相应的option中的值，那我们看<a href="http://jsfiddle.net/justlaputa/NGzDD/13/">这段代码</a>:</p>

<pre><code>&lt;select id="choise"&gt;
  &lt;option value="1"&gt;One&lt;/option&gt;
  &lt;option value="2"&gt;Two&lt;/option&gt;
  &lt;option value="3"&gt;Three&lt;/option&gt;
  &lt;option value="4"&gt;Four&lt;/option&gt;
&lt;/select&gt;

&lt;p id="result"&gt;&lt;/p&gt;

$('#choise').click(function(event) {
    $('#result').html($(this).val());
});
</code></pre>

<p>可以看到，选中后显示的值变成了<code>1, 2, 3, 4</code>，那么什么是 <em>option</em> 的 <strong>value</strong> 呢？从这两段代码就能看出来 <em>option</em> 真正的 <strong>value</strong> 应该是其 value 属性中的值，而不是 <em>option</em> 标签中间所包含的内容，这段内容实际上是 <em>option</em> 对象的 <strong>text</strong> 值，将如上的 javascript 代码<a href="http://jsfiddle.net/justlaputa/NGzDD/17/">换成如下</a>就能得到跟之前一样的效果了。</p>

<pre><code>$('#choise').click(function(event) {
  $('#result').html($('#choise option:selected').text());
});
</code></pre>

<p>实际上，在 <a href="www.w3schools.com">w3school</a> 的<a href="http://www.w3schools.com/tags/att_option_value.asp">文档</a>中对 <em>option</em> 的 <strong>value</strong> 属性的做了如下定义：</p>

<blockquote><p>The value attribute specifies the value to be sent to a server when a form is submitted.</p>

<p>The content between the opening &lt;option> and closing &lt;/option> tags is what the browsers will display in a drop-down list. However, the value of the value attribute is what will be sent to the server when a form is submitted.</p>

<p><strong>Note:</strong> If the value attribute is not specified, the content will be passed as the value instead.</p></blockquote>

<p>  这一点对于所有可以拥有 <strong>value</strong> <a href="http://www.w3.org/TR/html4/index/attributes.html">属性</a>的标签都是相同的，即在对一个元素调用 <strong>.val()</strong> 函数时，首先取其 <strong>value</strong> 属性的值，如果没有的话，再使用其 <strong>text</strong> 值。</p>

<h2>JQuery 代码</h2>

<p>知道了这个还不够，我们可以看看 <a href="http://jquery.com/">JQuery</a> 是如何处理元素的value的，即如何实现 .val() 函数。</p>

<p>在 <a href="http://code.jquery.com/jquery-1.7.2.js">jquery-1.7.2</a> 中对 .val() 的实现代码只有两段，如下：</p>

<pre><code>val: function( value ) {
    var hooks, ret, isFunction,
        elem = this[0];

    if ( !arguments.length ) {
        if ( elem ) {
            hooks = jQuery.valHooks[ elem.type ] ||
             jQuery.valHooks[ elem.nodeName.toLowerCase() ];

            if ( hooks &amp;&amp; "get" in hooks &amp;&amp; (ret = hooks.get( elem, "value" )) !== undefined ) {
                return ret;
            }

            ret = elem.value;

            return typeof ret === "string" ?
                // handle most common string cases
                ret.replace(rreturn, "") :
                // handle cases where value is null/undef or number
                ret == null ? "" : ret;
        }

        return;
    }

    isFunction = jQuery.isFunction( value );

    return this.each(function( i ) {
        var self = jQuery(this), val;

        if ( this.nodeType !== 1 ) {
            return;
        }

        if ( isFunction ) {
            val = value.call( this, i, self.val() );
        } else {
            val = value;
        }

        // Treat null/undefined as ""; convert numbers to string
        if ( val == null ) {
            val = "";
        } else if ( typeof val === "number" ) {
            val += "";
        } else if ( jQuery.isArray( val ) ) {
            val = jQuery.map(val, function ( value ) {
                return value == null ? "" : value + "";
            });
        }

        hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];

        // If set returns undefined, fall back to normal setting
        if ( !hooks || !("set" in hooks) || hooks.set( this, val, "value" ) === undefined ) {
            this.value = val;
        }
    });
}

jQuery.extend({
valHooks: {
    option: {
        get: function( elem ) {
            // attributes.value is undefined in Blackberry 4.7 but
            // uses .value. See #6932
            var val = elem.attributes.value;
            return !val || val.specified ? elem.value : elem.text;
        }
    },
    select: {
        get: function( elem ) {
            var value, i, max, option,
                index = elem.selectedIndex,
                values = [],
                options = elem.options,
                one = elem.type === "select-one";

            // Nothing was selected
            if ( index &lt; 0 ) {
                return null;
            }

            // Loop through all the selected options
            i = one ? index : 0;
            max = one ? index + 1 : options.length;
            for ( ; i &lt; max; i++ ) {
                option = options[ i ];

                // Don't return options that are disabled or in a disabled optgroup
                if ( option.selected &amp;&amp; (jQuery.support.optDisabled ? !option.disabled : option.getAttribute("disabled") === null) &amp;&amp;
                        (!option.parentNode.disabled || !jQuery.nodeName( option.parentNode, "optgroup" )) ) {

                    // Get the specific value for the option
                    value = jQuery( option ).val();

                    // We don't need an array for one selects
                    if ( one ) {
                        return value;
                    }

                    // Multi-Selects return an array
                    values.push( value );
                }
            }

            // Fixes Bug #2551 -- select.val() broken in IE after form.reset()
            if ( one &amp;&amp; !values.length &amp;&amp; options.length ) {
                return jQuery( options[ index ] ).val();
            }

            return values;
        },

        set: function( elem, value ) {
            var values = jQuery.makeArray( value );

            jQuery(elem).find("option").each(function() {
                this.selected = jQuery.inArray( jQuery(this).val(), values ) &gt;= 0;
            });

            if ( !values.length ) {
                elem.selectedIndex = -1;
            }
            return values;
        }
    }
},
</code></pre>

<p>可以看到 valHooks 对 <em>select</em> 和 <em>option</em> 标签做了处理，对于 <strong>select</strong> 对象，在使用 <strong>.val()</strong> 函数时调用 <strong>get</strong> 方法，找到被选中(selected)的option，并返回 option.val()，在使用 <strong>.val(value)</strong> 函数时，调用 <strong>set</strong> 方法，找到 option 中值与 <em>value</em> 相同的，并设置其为 selected. 对 <em>option</em> 标签的 hook 也可以同样分析。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Buy HHKB]]></title>
    <link href="http://laputa.io/blog/2012/08/05/buy-hhkb/"/>
    <updated>2012-08-05T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/08/05/buy-hhkb</id>
    <content type="html"><![CDATA[<h1>入HHKB</h1>

<p>前两天把我的Filco 忍者87 青轴出掉了，出得还算顺利。在萌购上下单入了<a href="http://elitekeyboards.com/products.php?sub=pfu_keyboards,hhkbpro2&amp;pid=pdkb400b">HHKB</a>，小记一下第一次日本海淘的过程。</p>

<!--more-->


<ul>
<li><em>2012-08-05</em> 萌购下单</li>
<li><em>2012-08-05</em> 14分钟后，萌购向日本Amazon下单，等待发货（萌购反应真快）</li>
<li><em>2012-08-06</em> Amazon.jp 发货</li>
<li><em>2012-08-14</em> 到达萌购日本仓库，等待发货（日本物流真心慢。。）</li>
<li><em>2012-08-15</em> 萌购发货（顺丰到付）</li>
<li><em>2012-08-17</em> 顺丰到货</li>
</ul>


<p>17号没空收货，于是让顺丰推迟了一天发货，今天早上（18日）拿到键盘。</p>

<p>第一次在萌购海淘，总体还算是很顺利的，前后一共12天，比在美国亚马逊海淘要快一个多星期，上一次在美国亚马逊买的东西用了20多天才到手。不过也在可接受的范围之内了，毕竟海淘就要做好耐心等待的准备么。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Newly Install Ubuntu]]></title>
    <link href="http://laputa.io/blog/2012/07/30/newly-install-ubuntu/"/>
    <updated>2012-07-30T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/07/30/newly-install-ubuntu</id>
    <content type="html"><![CDATA[<h1>Replace my work environment to Ubuntu</h1>

<p>Just some notes for my newly installed Ubuntu Linux configuration, use it if this helps.</p>

<!--more-->


<h2>install ubuntu and upgrade</h2>

<p>I installed <a href="http://www.ubuntu.com/">Ubuntu 12.04</a> using live usb, createed by <a href="http://www.linuxliveusb.com/">LinuxLive USB Creator</a>, after install:</p>

<pre><code>sudo apt-get update
sudo apt-get upgrade
</code></pre>

<h2>System config</h2>

<h3>add user to sudo</h3>

<p>Don&rsquo;t know why, in Ubuntu 12.04 you should add the username at the last line, otherwise it won&rsquo;t work</p>

<pre><code>sudo visudo
# add at bottom line
username  ALL=(ALL)NOPASSWD:ALL
</code></pre>

<h3>disable ALT key shortcut</h3>

<p>Sometimes it is annoying to see the HUD window when pressing ALT key, disable like this:</p>

<pre><code>Settings-&gt;keyboard-&gt;shortcuts-&gt;key to show the HUD-&gt;(press backspace to disable)
</code></pre>

<h3>disable ALT key on gnome-terminal</h3>

<p>I use zsh and emacs key-binding, so I use alt key a lot, but this is bind to show Menu item in gnome-terminal, disable it like this:</p>

<pre><code>Open gnome-terminal:
Edit-&gt;Keyboard Shortcuts-&gt;Uncheck menu access keys
</code></pre>

<h3>change ubuntu tooltip color</h3>

<p>By default, the tooltip window color is white-on-black, which is not so cheerful, especially when you are using Eclipse. Change the color to black-on-yellow like this:</p>

<pre><code>vim /usr/share/themes/Ambiance/gtk-2.0/gtkrc
gtk-color-scheme = "base_color:#ffffff\nfg_color:#4c4c4c\ntooltip_fg_color:#000000\nselected_bg_color:#f07746\nselected_fg_color:#FFFFFF\ntext_color:#3C3C3C\nbg_color:#F2F1F0\ntooltip_bg_color:#ffffaf\nlink_color:#DD4814"
</code></pre>

<p>Note that <code>Ambiance</code> is the default gtk color theme, if you are using other theme, edit the corresponding <code>gtkrc</code> file. Log out or restart to see the change.</p>

<h3>auto hide launcher</h3>

<pre><code>Settings-&gt;Appearance-&gt;Behavior-&gt;turn on auto hide
</code></pre>

<h2>Software</h2>

<h3>common:</h3>

<pre><code>sudo apt-get install vim emacs emacs-goodies-el zsh tmux
## if you use zsh
chsh -s /bin/zsh
</code></pre>

<h3>git</h3>

<pre><code>sudo apt-get install git gitk
git config --global user.name my_name
git config --global user.email my_name@some.mail.com
git config --global color.ui auto
</code></pre>

<p>I host my home config files on <a href="https://github.com/justlaputa">github</a>, so add this to my home directory</p>

<pre><code>cd ~
git init
git remote add origin git@github.com:justlaputa/home-config.git
git fetch origin
git checkout -t origin/master
</code></pre>

<h3>maven</h3>

<pre><code>sudo apt-get install maven
</code></pre>

<h3>chrome</h3>

<p>Download deb file from google <a href="https://www.google.com/chrome/">official site</a>, or if you want to use unstable release, download from <a href="http://www.chromium.org/getting-involved/dev-channel/">Chrome Release Channel</a>, double click the deb file, it will be installed automatically.</p>

<h3>java</h3>

<p>   download from oracle <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">jdk site</a>, see this <a href="https://help.ubuntu.com/community/Java#Oracle_.28Sun.29_Java_6">tutorial</a> to config java</p>

<pre><code>sudo sh jdk-6u33-linux-i586.bin
sudo mv jdk1.6.0_33 /usr/java
sudo ln -s jdk1.6.0_33 default
</code></pre>

<p> config environment variable in your bash config file(or zsh profile)</p>

<pre><code>vim ~/.baserc
JAVA_HOME=/usr/java/default
export JAVA_HOME
</code></pre>

<p> config java</p>

<pre><code>sudo update-alternatives --install "/usr/bin/java" "java" "/usr/java/default/bin/java" 1
sudo update-alternatives --config java
(select 1)
</code></pre>

<p> do the same to <strong>javac</strong>, <strong>javasw</strong>, <strong>libjavaplugin.so</strong>, see the above link, then check java version:</p>

<pre><code> java -version
 javac -version
</code></pre>

<h3>eclipse</h3>

<p> download from <a href="http://eclipse.org/downloads/">official site</a></p>

<pre><code>mkdir ~/dev
cd ~/dev
tar xzf ~/Downloads/eclipse-jee-juno-linux-gtk.tar.gz
</code></pre>

<h4>eclipse plugins</h4>

<ul>
<li><a href="http://wiki.eclipse.org/Jetty_WTP_Plugin/Jetty_WTP_Install">jetty wtp</a></li>
</ul>


<h2>Other software</h2>

<h3>fcitx &ndash; input method</h3>

<pre><code>sudo apt-get install fcitx
</code></pre>

<p>open <strong>Input Method Swithcher</strong>, and select fcitx, re-login or restart.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A simple Git cheat sheet and tips]]></title>
    <link href="http://laputa.io/blog/2012/07/11/a-simple-git-cheat-sheet-and-tips/"/>
    <updated>2012-07-11T00:00:00+09:00</updated>
    <id>http://laputa.io/blog/2012/07/11/a-simple-git-cheat-sheet-and-tips</id>
    <content type="html"><![CDATA[<p>Here is a simple Git cheat sheet and I will update this when I find new ones.</p>

<!--more-->


<h2>Cheat Sheet:</h2>

<h3>config:</h3>

<pre><code> $ git config --global user.name "John Doe"
 $ git config --global user.email johndoe@example.com
</code></pre>

<p>   this will store your identity in <em>~/.gitconfig</em>, use <code>--system</code> to store in <em>/etc/gitconfig</em>, use <code>--local</code> to specify a per-repository configuration, which stores in <em>.git/config</em>.</p>

<h3>log</h3>

<pre><code>| git log                                           | view commit log                    |
| git log -p -2                                     | show patch of last 2 commit        |
| git log --stat                                    | show simple state                  |
| git log --pretty=oneline                          | show in other formats              |
| git log --graph --all --decorate --pretty=oneline | show all branch commits with graph |
</code></pre>

<h3>undo things</h3>

<pre><code>| git commit --amend       | this will overwrite the last commit |
| git reset HEAD~1         | discard last commit                 |
| git reset HEAD filename  | unstage a file                      |
| git checkout -- filename | undo modified file                  |
</code></pre>

<h3>remote</h3>

<pre><code>| git remote -v                    | show remote repository  |
| git remote add [shortname] [url] | add remote repository   |
| git fetch [remote]               | fetch remote            |
| git remote show [shortname]      | show remote infomation  |
| git remote rename [from] [to]    | rename remote shortname |
| git remote rm [remote]           | remove remote           |
</code></pre>

<h2>Tricks &amp; Tips</h2>

<h3>clone into an existing directory</h3>

<p>clone a repo into an existing directory,</p>

<pre><code>$ cd PATH/YOU/WANT/TO/PUT/GIT/FILES
$ git init
$ git remote add origin git://remote.repo.url.path
$ git fetch
$ git checkout -t origin/master
</code></pre>

<p><code>fetch</code> will get all remote branches to local, but we still need the <code>checkout</code> command to switch to a specific branch,  <code>-t</code> implies <code>-b</code>, which tells git to create a local <strong>master</strong> branch and make it to track the remote master branch, which is <strong>origin/master</strong>.</p>

<h3>view the history of a single file</h3>

<pre><code>$ git log -p filename
$ git whatchanged -p filename

$ git log -p --follow filename
$ git blame filename

$ gitk filename
</code></pre>

<h3>checkout a single file from another branch</h3>

<pre><code>$ git checkout branch_1 -- path/to/file
</code></pre>

<h3>revert to previous commit/discard current commit</h3>

<p>  if you doesn&rsquo;t push your commit:</p>

<pre><code>git reset --hard HEAD~1
</code></pre>

<p>  if you already push your commit:</p>

<pre><code>git revert HEAD
</code></pre>

<h3>rewrite last commit message</h3>

<p>  see this<a href="http://stackoverflow.com/questions/179123/how-do-i-edit-an-incorrect-commit-message-in-git">stackoverflow questions</a></p>

<pre><code>git commit --amend -m "New commit message"
</code></pre>

<h3>discard all modify</h3>

<pre><code>git checkout .
</code></pre>

<h3>working with remotes</h3>

<p>  create remote branch</p>

<pre><code>$ git push REMOTENAME BRANCHNAME
</code></pre>

<p>  delete remote branch</p>

<pre><code>$ git push REMOTENAME :BRANCHNAME
</code></pre>

<p>  pushing tags</p>

<pre><code>$ git push REMOTENAME TAGNAME
$ git push REMOTENAME BRANCHNAME --tags
</code></pre>

<p>  push to multiple remotes at the same time</p>

<pre><code>$ vim .git/config
[remote "all"]
url = git@github.com:luoshupeng/commonuseppa.git
url = git@gitcafe.com:chinesedragon/commonuseppa.git
url = chinesedragon@gitcd.com:/commonuseppa
$ git push all
</code></pre>

<p>this will push to all urls</p>

<h3>show/hide untracked files</h3>

<pre><code>$ git status -u   #show only untracked files
$ git status -uno #don't show untracked files
$ git config status.showuntrackedfiles no

# List git-ignored files
$ git ls-files . --ignored --exclude-standard --others

# List untracked files
$ git ls-files . --exclude-standard --others
</code></pre>

<h3>checkout single file from stash</h3>

<p>  see more <a href="http://stackoverflow.com/questions/1105253/how-would-i-extract-a-single-file-or-changes-to-a-file-from-a-git-stash">here</a></p>

<pre><code>$ git checkout stash@{0} -- &lt;filename&gt;
</code></pre>
]]></content>
  </entry>
  
</feed>
